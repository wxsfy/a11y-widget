(()=>{(function(){let x=window.A11yWidget=window.A11yWidget||{};if(x.__initd)return;x.__initd=!0;let Y={position:"right",bottom:"24px",sideOffset:"24px",accent:"#1e88e5",zIndex:999999,readVoice:null,styleNonce:void 0},n={base:"a11y-base",dyslexia:"a11y-dyslexia",theme:"data-a11y-theme",active:"data-a11y-active"},P="__a11y_prefs__",i=X();function X(){try{return JSON.parse(localStorage.getItem(P)||"{}")}catch{return{}}}function G(){try{localStorage.setItem(P,JSON.stringify(i))}catch{}}function N(u,d,r){return Math.max(d,Math.min(r,u))}let _=u=>Math.round(u*100);function Q(u,d,r){if(document.getElementById("a11y-style"))return;let a=[":root{ --a11y-accent:"+u+"; --a11y-bottom:var(--a11y-bottom,24px); --a11y-side:var(--a11y-side,24px); --a11y-fg:#111; --a11y-bg:#fff; }","@font-face{ font-family:'OpenDyslexic'; font-style:normal; font-weight:400; src: local('OpenDyslexic'), local('OpenDyslexic Regular'); }","html."+n.base+"{ font-size: calc(16px * var(--a11y-font-scale,1)); }","html["+n.theme+'="default"]{ --a11y-fg:#111; --a11y-bg:#fff; }',"html["+n.theme+'="contrast"]{ --a11y-fg:#000; --a11y-bg:#fff; }',"html["+n.theme+'="dark"]{ --a11y-fg:#f5f5f5; --a11y-bg:#121212; }',"html["+n.theme+'="sepia"]{ --a11y-fg:#3b2f2f; --a11y-bg:#f4ecd8; }',"html."+n.base+" body{ color: var(--a11y-fg); background: var(--a11y-bg); }","html."+n.dyslexia+' *{ font-family:"OpenDyslexic", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important; }',":where(button,[href],input,select,textarea,[tabindex]):focus-visible{ outline:3px solid var(--a11y-accent); outline-offset:2px; }",".sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,1px,1px); white-space:nowrap; border:0; }",".a11y-btn{ position:fixed; bottom:var(--a11y-bottom); inset-inline-end:var(--a11y-side); z-index:"+d+"; width:56px; height:56px; border-radius:50%; background:var(--a11y-accent); color:#fff; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,.2); border:none; cursor:pointer; }",".a11y-btn:focus{ outline:3px solid #fff; outline-offset:3px; }",".a11y-panel{ position:fixed; bottom:calc(var(--a11y-bottom) + 64px); inset-inline-end:var(--a11y-side); z-index:"+d+"; background:#fff; color:#111; width:min(92vw,360px); border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.25); border:1px solid #eee; display:none; opacity:0; transition:opacity .12s ease; }",".a11y-panel["+n.active+'="true"]{ display:block; opacity:1; }',"@media (prefers-reduced-motion: reduce){ .a11y-panel{ transition:none; } }",".a11y-hdr{ padding:12px 14px; font-weight:700; border-bottom:1px solid #eee; display:flex; align-items:center; gap:8px; }",".a11y-row{ display:grid; grid-template-columns: 1fr auto; align-items:start; padding:12px 14px; gap:10px 12px; }",".a11y-row + .a11y-row{ border-top:1px solid #f3f3f3; }",".a11y-actions{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:flex-end; max-width:100%; }",".a11y-chip,.a11y-ctrl{ border:1px solid #ddd; background:#fafafa; border-radius:8px; padding:10px 12px; cursor:pointer; min-height:44px; white-space:nowrap; }",".a11y-select{ padding:8px 10px; border:1px solid #ddd; border-radius:8px; background:#fafafa; max-width:100%; min-height:44px; }",".a11y-pill{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid #ddd; background:#f7f7f7; }",".a11y-actions > *{ flex:0 0 auto; }",".a11y-note{ font-size:12px; color:#666; padding:8px 14px 14px; }",'html[data-a11y-compact="true"] .a11y-row{ grid-template-columns: 1fr; }','html[data-a11y-compact="true"] .a11y-actions{ justify-content:stretch; }','html[data-a11y-compact="true"] .a11y-actions > *{ flex:1 1 auto; }',"@media (max-width: 420px){ .a11y-row{ grid-template-columns:1fr; } .a11y-actions{ justify-content:stretch; } .a11y-actions > *{ flex:1 1 auto; } }","html["+n.theme+'="dark"] .a11y-panel{ background:#1b1b1b; color:#f5f5f5; border-color:#2a2a2a; }',"html["+n.theme+'="sepia"] .a11y-panel{ background:#fffaf0; }'].join(`
`),c=document.createElement("style");c.id="a11y-style",r&&c.setAttribute("nonce",r),c.textContent=a,document.head.appendChild(c)}function t(u,d={},r=[]){let a=document.createElement(u);return Object.entries(d).forEach(([c,l])=>{c==="class"?a.className=l:c==="text"?a.textContent=l:c.startsWith("on")&&typeof l=="function"?a.addEventListener(c.slice(2),l):a.setAttribute(c,l)}),r.forEach(c=>a.appendChild(c)),a}function k(){"speechSynthesis"in window&&speechSynthesis.cancel()}function L(u,d){if(!("speechSynthesis"in window))return;k();let r=new SpeechSynthesisUtterance(u);function a(){if(!d)return;let l=((typeof speechSynthesis.getVoices=="function"?speechSynthesis.getVoices():[])||[]).find(o=>o.name===d);l&&(r.voice=l)}if(a(),!r.voice){let c=speechSynthesis.onvoiceschanged;speechSynthesis.onvoiceschanged=()=>{a(),c&&typeof c=="function"&&c()}}speechSynthesis.speak(r)}x.init=function(d={}){if(x.__mounted)return;let r=Object.assign({},Y,d),a=document.documentElement;a.style.setProperty("--a11y-bottom",r.bottom),a.style.setProperty("--a11y-side",r.sideOffset),Q(r.accent,r.zIndex,r.styleNonce),a.classList.add(n.base),a.style.setProperty("--a11y-font-scale",String(i.fontScale||1));let c=i.theme;if(c)a.setAttribute(n.theme,c);else{let e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;a.setAttribute(n.theme,e?"dark":"default")}i.dyslexia?a.classList.add(n.dyslexia):a.classList.remove(n.dyslexia);let l=t("button",{class:"a11y-btn","aria-label":"Open accessibility menu",title:"Accessibility options"},[t("span",{"aria-hidden":"true",text:"\u267F"})]),o=t("div",{class:"a11y-panel",role:"dialog","aria-modal":"true"}),D="a11y-panel-"+Math.random().toString(36).slice(2);o.id=D,l.setAttribute("aria-haspopup","dialog"),l.setAttribute("aria-expanded","false"),l.setAttribute("aria-controls",D);let O=t("div",{class:"sr-only","aria-live":"polite"}),Z=t("div",{class:"a11y-hdr"},[t("span",{text:"Accessibility"})]),z=t("span",{class:"a11y-pill",text:_(i.fontScale||1)+"%"}),$=t("div",{class:"a11y-row"},[t("div",{text:"Text size"}),t("div",{class:"a11y-actions"},[t("button",{class:"a11y-ctrl","aria-label":"Decrease text size",title:"Decrease text size",onclick:F},[document.createTextNode("\u2212")]),t("button",{class:"a11y-ctrl","aria-label":"Increase text size",title:"Increase text size",onclick:V},[document.createTextNode("+")]),t("button",{class:"a11y-ctrl","aria-label":"Reset text size",title:"Reset text size",onclick:M},[document.createTextNode("Reset")]),z])]),S=t("select",{class:"a11y-select","aria-label":"Theme"},[new Option("Default","default"),new Option("High contrast","contrast"),new Option("Dark","dark"),new Option("Sepia","sepia")]);S.value=c||a.getAttribute(n.theme)||"default",S.addEventListener("change",()=>j(S.value));let ee=t("div",{class:"a11y-row"},[t("div",{text:"Theme"}),t("div",{class:"a11y-actions"},[S])]),I=t("button",{class:"a11y-chip","aria-pressed":String(!!i.dyslexia),"aria-label":"Toggle dyslexia-friendly font",title:"Toggle dyslexia-friendly font",onclick:()=>B()},[document.createTextNode("Toggle")]),te=t("div",{class:"a11y-row"},[t("div",{text:"Dyslexia-friendly font"}),t("div",{class:"a11y-actions"},[I])]),ae=t("button",{class:"a11y-ctrl","aria-label":"Read the page",title:"Read page",onclick:W},[document.createTextNode("Read")]),ne=t("button",{class:"a11y-ctrl","aria-label":"Read selected text",title:"Read selected text",onclick:K},[document.createTextNode("Read selection")]),se=t("button",{class:"a11y-ctrl","aria-label":"Pause or resume reading",title:"Pause/Resume",onclick:U},[document.createTextNode("Pause/Resume")]),oe=t("button",{class:"a11y-ctrl","aria-label":"Stop reading",title:"Stop",onclick:H},[document.createTextNode("Stop")]),ie=t("div",{class:"a11y-row"},[t("div",{text:"Read aloud"}),t("div",{class:"a11y-actions"},[ae,ne,se,oe])]),b=!1,y,g=t("span",{class:"a11y-pill",text:"Idle"}),ce=t("button",{class:"a11y-ctrl","aria-label":"Start or stop voice recognition",title:"Start/Stop voice recognition",onclick:ue},[document.createTextNode("Start/Stop")]),re=t("div",{class:"a11y-row"},[t("div",{text:"Voice commands (beta)"}),t("div",{class:"a11y-actions"},[ce,g])]),le=t("div",{class:"a11y-note",text:"Prefs saved to your browser. Voice features depend on device support."});o.appendChild(Z),o.appendChild($),o.appendChild(ee),o.appendChild(te),o.appendChild(ie),o.appendChild(re),o.appendChild(le),o.appendChild(O);let T=null;function R(){T=document.activeElement,o.setAttribute(n.active,"true"),l.setAttribute("aria-expanded","true"),(o.querySelector('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])')||o).focus()}function A(){o.setAttribute(n.active,"false"),l.setAttribute("aria-expanded","false"),T&&T.focus()}function de(e){if(o.getAttribute(n.active)!=="true"||e.key!=="Tab")return;let s=o.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');if(!s.length)return;let m=s[0],f=s[s.length-1];e.shiftKey&&document.activeElement===m?(e.preventDefault(),f.focus()):!e.shiftKey&&document.activeElement===f&&(e.preventDefault(),m.focus())}l.addEventListener("click",()=>o.getAttribute(n.active)==="true"?A():R()),o.addEventListener("keydown",de),window.addEventListener("keydown",e=>{e.key==="Escape"&&A()}),window.addEventListener("keydown",e=>{e.altKey&&e.shiftKey&&(e.key==="A"||e.key==="a")&&(e.preventDefault(),R())}),document.body.appendChild(l),document.body.appendChild(o);function h(){a.style.setProperty("--a11y-font-scale",String(i.fontScale||1)),a.setAttribute(n.theme,i.theme||a.getAttribute(n.theme)||"default"),i.dyslexia?a.classList.add(n.dyslexia):a.classList.remove(n.dyslexia),z.textContent=_(i.fontScale||1)+"%",I.setAttribute("aria-pressed",String(!!i.dyslexia)),G();let e=(i.fontScale||1)>=1.75;a.setAttribute("data-a11y-compact",e?"true":"false")}function V(){i.fontScale=Number(N((i.fontScale||1)+.1,.7,2).toFixed(2)),h(),p("Text larger")}function F(){i.fontScale=Number(N((i.fontScale||1)-.1,.7,2).toFixed(2)),h(),p("Text smaller")}function M(){i.fontScale=1,h(),p("Text size reset")}function j(e){i.theme=e,h(),p("Theme: "+e)}function B(e){i.dyslexia=typeof e=="boolean"?e:!i.dyslexia,h(),p("Dyslexia font "+(i.dyslexia?"on":"off"))}function fe(e=3e3){let s=window.getSelection&&window.getSelection().toString().trim();if(s)return s.slice(0,e);let m=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:v=>v.textContent&&v.textContent.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),f="",w;for(;(w=m.nextNode())&&f.length<e;){let v=w.textContent.trim();v&&(f+=v+" ")}return f.slice(0,e)}function W(){let e=fe();e&&(L(e,r.readVoice),p("Reading page"))}function K(){let e=window.getSelection&&window.getSelection().toString()||"";e.trim()&&(L(e.trim(),r.readVoice),p("Reading selection"))}function U(){if(!("speechSynthesis"in window))return;let e=window.speechSynthesis;e.speaking&&!e.paused?(e.pause(),p("Paused")):e.paused&&(e.resume(),p("Resumed"))}function H(){k(),p("Stopped")}function p(e){O.textContent=e}function J(e){if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return!1;let s=window.SpeechRecognition||window.webkitSpeechRecognition;return y=new s,y.lang="en-US",y.continuous=!0,y.interimResults=!1,y.onresult=m=>{for(let f=m.resultIndex;f<m.results.length;f++)if(m.results[f].isFinal){let w=m.results[f][0].transcript.trim().toLowerCase();g.textContent="Heard: "+w,e(w)}},y.onend=()=>{b=!1,g.textContent="Idle"},y.start(),b=!0,g.textContent="Listening\u2026",!0}function C(){y&&b&&(y.stop(),b=!1,g.textContent="Idle")}function ue(){if(b){C();return}J(s=>q(s,E))||alert("Voice recognition not supported on this device.")}function q(e,s){/(increase (text|font)|bigger text)/.test(e)?s.fontPlus():/(decrease (text|font)|smaller text)/.test(e)?s.fontMinus():/reset (text|font)/.test(e)?s.fontReset():/(theme )?(contrast|high contrast)/.test(e)?s.setTheme("contrast"):/(theme )?dark/.test(e)?s.setTheme("dark"):/(theme )?sepia/.test(e)?s.setTheme("sepia"):/(theme )?(default|normal)/.test(e)?s.setTheme("default"):/read selection/.test(e)?s.readSelection():/read (page|this)/.test(e)?s.readPage():/(pause|resume)/.test(e)?s.pauseResume():/(stop|cancel)/.test(e)?s.stopRead():/open (menu|panel)/.test(e)?s.open():/(close|hide) (menu|panel)/.test(e)&&s.close()}let E={open:R,close:A,fontPlus:V,fontMinus:F,fontReset:M,setTheme:j,toggleDyslexia:B,readPage:W,readSelection:K,pauseResume:U,stopRead:H,startVoice:()=>J(e=>q(e,E)),stopVoice:C};x.api=E,x.destroy=function(){try{C(),k(),l.remove(),o.remove(),a.classList.remove(n.base,n.dyslexia),a.removeAttribute(n.theme),a.removeAttribute("data-a11y-compact"),x.__mounted=!1}catch{}},o.setAttribute(n.active,"false"),h(),x.__mounted=!0},setTimeout(()=>{try{document.dispatchEvent(new CustomEvent("A11yWidgetReady"))}catch{}},0)})();})();
